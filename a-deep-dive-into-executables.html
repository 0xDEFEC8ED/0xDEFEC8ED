<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>A Deep Dive Into Executables - Diary of a Cybersec Enthusiast</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="/a-deep-dive-into-executables.html">

        <meta name="author" content="samarth" />
        <meta name="keywords" content="reverse-engineering" />
        <meta name="description" content="When I was in middle school, I was introduced to this new kind of magical number system called &#34;binary&#34;. Since then, I have always been facinated by 0&#39;s and 1&#39;s. I always wondered how different combinations of just 2 possibilities ccould build something so complex and beautiful as the internet …" />

        <meta property="og:site_name" content="Diary of a Cybersec Enthusiast" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="A Deep Dive Into Executables"/>
        <meta property="og:url" content="/a-deep-dive-into-executables.html"/>
        <meta property="og:description" content="When I was in middle school, I was introduced to this new kind of magical number system called &#34;binary&#34;. Since then, I have always been facinated by 0&#39;s and 1&#39;s. I always wondered how different combinations of just 2 possibilities ccould build something so complex and beautiful as the internet …"/>
        <meta property="article:published_time" content="2020-04-11" />
            <meta property="article:section" content="reverse-engineering" />
            <meta property="article:tag" content="reverse-engineering" />
            <meta property="article:author" content="samarth" />



    <!-- Bootstrap -->
        <link rel="stylesheet" href="/theme/css/bootstrap.darkly.min.css" type="text/css"/>
    <link href="/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="/theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="/theme/css/style.css" type="text/css"/>
        <link href="/static/css/custom.css" rel="stylesheet">



</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="/" class="navbar-brand">
Diary of a Cybersec Enthusiast            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                        <li >
                            <a href="/category/misc.html">Misc</a>
                        </li>
                        <li class="active">
                            <a href="/category/reverse-engineering.html">Reverse-engineering</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<!-- Banner -->
<!-- End Banner -->

<!-- Content Container -->
<div class="container-fluid">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="/a-deep-dive-into-executables.html"
                       rel="bookmark"
                       title="Permalink to A Deep Dive Into Executables">
                        A Deep Dive Into Executables
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2020-04-11T19:00:00+05:30"> Sat 11 April 2020</time>
    </span>





<span class="label label-default">Tags</span>
	<a href="/tag/reverse-engineering.html">reverse-engineering</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>When I was in middle school, I was introduced to this new kind of magical number system called "binary". Since then, I have always been facinated by 0's and 1's. I always wondered how different combinations of just 2 possibilities ccould build something so complex and beautiful as the internet. I soon began to understand how things needed to be planned out before you start to build it. Reverse-Engineering is different. It needs practice. It requires experience. And you can never say that you've had enough of both to say that you are good at it.</p>
<p><strong>DISCLAIMER</strong> : Most of the information in this article will be written from memory and when needed, google will come to rescue me from my 2 brain cells. I know that I have taken up a very difficult topic to make a blog post on, but I will still try to cover as can accodomate without getting lost in this rabit hole. I am not sure of how well this article will drafted for a general audience and therefore I suggest some futher read if needed. Also, I should also mention that you might need some programming background to understand the article from this damned canvas. </p>
<blockquote>
<p>This topic offers a huge amount of information, and I am by no means an expert in this subject. I will still try to keep it short and convey my knowledge in this subjects through the written content as well as some references attached.</p>
</blockquote>
<h3><strong>What is a file?</strong></h3>
<p>It is easy to define a file in terms of <a href="https://en.wikipedia.org/wiki/Linux">Linux</a>. - everything in linux is a file.
<a href="http://man7.org/linux/man-pages/man5/elf.5.html">ELF</a> is a File standard that is used to define an executable file in linux.
in simpler terms, executable files are the files that are coded to perform an action upon execution. It is a standard binary format for Linux and Unix-like systems on x86 processors. ELF64 is the revised standard for systems on x64 processors.</p>
<p>Again, in linux terms, extensions like ".exe" are useless. But for simplicity, I would like some regular users to associate an executable file with files that end with .so, .o, .bin, .elf and even .exe.</p>
<p>A file is simply an abstract object filled with chunks of 0's and 1's that might not make sense when looked under a microscope, but when you will zoom out a little, it will begin to make patterns. Initially those patterns might seem too complex and tangled to be designed by a human mind, but that is the true beauty that is truly facinating.</p>
<p>To understand what we what to achieve in this post, I will compile a simple C program and try to disect it using some well known tools like hexeditor and Ghidra which can be found in either github, or standard repositories of whichever linux distro suits you taste.</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">buffer</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="mi">14</span><span class="p">);</span>
    <span class="n">buffer</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;h&#39;</span><span class="p">;</span>
    <span class="n">buffer</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;a&#39;</span><span class="p">;</span>
    <span class="n">buffer</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;c&#39;</span><span class="p">;</span>
    <span class="n">buffer</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;k&#39;</span><span class="p">;</span>
    <span class="n">buffer</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;t&#39;</span><span class="p">;</span>
    <span class="n">buffer</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;h&#39;</span><span class="p">;</span>
    <span class="n">buffer</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;e&#39;</span><span class="p">;</span>
    <span class="n">buffer</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;p&#39;</span><span class="p">;</span>
    <span class="n">buffer</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;l&#39;</span><span class="p">;</span>
    <span class="n">buffer</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;a&#39;</span><span class="p">;</span>
    <span class="n">buffer</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;n&#39;</span><span class="p">;</span>    
    <span class="n">buffer</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;e&#39;</span><span class="p">;</span>
    <span class="n">buffer</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;t&#39;</span><span class="p">;</span>
    <span class="n">buffer</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">input</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="mi">14</span><span class="p">);</span>
    <span class="kt">char</span> <span class="n">useless</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;hacktheplanet&quot;</span><span class="p">;</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Enter the password: &quot;</span><span class="p">);</span>
    <span class="n">fgets</span><span class="p">(</span><span class="n">input</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="n">stdin</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">strncmp</span><span class="p">(</span><span class="n">input</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;This is the secret Flag</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Access denied!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;}</span>
</code></pre></div>


<p>Compiling the above code using gcc,</p>
<div class="highlight"><pre><span></span><code>gcc <span class="m">1</span>.c -o out
</code></pre></div>


<p>I've attached a screenshot to give an idea of what we want to look at.
<img alt="Ghidra Import Result Summary with Hexdump" src="/static/images/exe-sc1.png" title="exe-sc1.png"></p>
<p>There is currently too much information on the screen to get overwhelmed easily. So lets start again.</p>
<p>An Executable file is compiled in such a way that that it essentially has some core components which must abide by the ABI of the system it needs to be run on(ABI is similar to an API, but it is different in a lot of ways since it is a term for more lower level components like Bootloader, Kernel, Operating System etc). You can also relate an Executable to a program built for any embedded system such as 8085, 8086 etc.</p>
<p>When we look into the Hex-Dump of this compiled executable, we can see that it is filled with hexadecimal representations of 64 bit information at a time. Import results of Ghidra tell us that it is an ELF file (as reflected on the initial header hump of the file), encoded in and built for little Endian based x86 processor. The operating system which I am currently using is an x64 build but since all x64 and x86 processors are successors of intel's 8086 architecture, any programs built for any processors in this line-up will always be compatible with all its previous generaton.</p>
<p>ELF is a file standard that most modern systems can understand as it is pretty well defined and most worked with. The two major sections defined in an ELF file are the "ELF Header", and "File DATA". File Data consists of many different sections to properly organise the different components of the code that needs to be executed.
The purpose of ELF header is simple, to inform the executer of the file (Operating system in general) of what it contains. Most of the information that you see in the import summary of Ghidra is directly provided, or derived from the header of the file. For more information on ELF headers, I have linked some useful sources to at the end of this article.</p>
<p><img alt="ELF layout table" src="/static/images/Elf-layout.svg" title="Elf-layout.svg"></p>
<p>Also, here is the ELF struct for get a gist of its purpose for those interested.</p>
<div class="highlight"><pre><span></span><code><span class="cp">#define EI_NIDENT 16</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">e_ident</span><span class="p">[</span><span class="n">EI_NIDENT</span><span class="p">];</span>
    <span class="kt">uint16_t</span>      <span class="n">e_type</span><span class="p">;</span>
    <span class="kt">uint16_t</span>      <span class="n">e_machine</span><span class="p">;</span>
    <span class="kt">uint32_t</span>      <span class="n">e_version</span><span class="p">;</span>
    <span class="n">ElfN_Addr</span>     <span class="n">e_entry</span><span class="p">;</span>
    <span class="n">ElfN_Off</span>      <span class="n">e_phoff</span><span class="p">;</span>
    <span class="n">ElfN_Off</span>      <span class="n">e_shoff</span><span class="p">;</span>
    <span class="kt">uint32_t</span>      <span class="n">e_flags</span><span class="p">;</span>
    <span class="kt">uint16_t</span>      <span class="n">e_ehsize</span><span class="p">;</span>
    <span class="kt">uint16_t</span>      <span class="n">e_phentsize</span><span class="p">;</span>
    <span class="kt">uint16_t</span>      <span class="n">e_phnum</span><span class="p">;</span>
    <span class="kt">uint16_t</span>      <span class="n">e_shentsize</span><span class="p">;</span>
    <span class="kt">uint16_t</span>      <span class="n">e_shnum</span><span class="p">;</span>
    <span class="kt">uint16_t</span>      <span class="n">e_shstrndx</span><span class="p">;</span>
<span class="p">}</span><span class="n">fN_Ehdr</span><span class="p">;</span>
</code></pre></div>


<p>Okay, I feel like I've successfully painted a picture of how trivial all this stuff is. lets get into the 'File data' section and understand what the compiler did to our beautifully written ASCII code to make it breathe. Again, if you want to properly understand as to why a simple machine that can only understand 0's and 1's is able to process this stuff, I suggest looking into the more primitive architectures like 8086 first to get a feel of how these different components work. For now lets open Ghidra and let it auto-analyse the code first.</p>
<p>ELF files generally require only 2 kinds of headers,</p>
<ul>
<li>ELF header and the program header, or</li>
<li>ELF header and the section header.</li>
</ul>
<p>What I mean by required is that more than 2 kinds of headers can also exist in an executable(when the C code that has been compiled to produce the binary contains external imports, as well as internal library function that are further meant to be exported).</p>
<p>Lets understand ELF files a bit more. ELF stands for Executable and Linkable Format. In general, I've mostly dealt with ELF files which are either plain old</p>
<ul>
<li>EXEC - Executable Files (typical C program with a main() function),</li>
<li>DYN  - Shared Libraries(shared libraries are loaded and linked into a program's process image at runtime) </li>
<li>REL  - Relocatable object files (Position independent code(PIC) that have not yet been linked into an executable)</li>
</ul>
<p>There are 2 more kinds of ELF formats but currently, I don't plan on doing further research to make this post too long.</p>
<h3><strong>Headers and their purpose</strong></h3>
<p><strong>ELF PROGRAM HEADER</strong> : This header is used to describe <strong>SEGMENTS</strong> (relate to memory segments in 8086) within the binary which is needed by the ABI layer to describe the memory layout of the executable. This header is needed for successful execution of a program. There is not much needed to know here other than the fact that the sections are essentially a derivation from old school 8086 architecture and if you are fluent in it, it'll be easier for you to understand this article better</p>
<p><em>There are some values defined in the struct of program headers which are really interesting for use-cases where the executable which needs to be reversed is being percieved difficult for an initial learner. Most of these values are further used by the section headers to properly define the different sections that are essential for de-compilers.
program header contains information (like size, offset and set values generally) on different segments and their permissions (for eg, READ+EXECUTE for text segment). Information on symbols table, string table, global offset table etc.</em></p>
<p><strong>ELF SECTION HEADER</strong> : This header defines the <strong>SECTIONS</strong> wich live inside the different <strong>SEGMENTS</strong> of the executable. Section headers are used to divide the segments, further into either code, or data. Section headers are not necessary for program execution and therefore, in more reverse engineering cases, sections headers will be either corrupted or missing.</p>
<p>In our current example, I have not stripped the compiled executable and therefore ghidra would directly be able to derive the necessary tables to make our life easier. Below is the screenshot of all the different sections that were detected by ghidra currently.</p>
<p>The most interesting sections are,
 <strong>.text</strong>   : It contains the program code. 
 <strong>.rodata</strong> : It contains holds all the read-only data such as strings from a line of C code such as a string defined in a printf() function. 
 <strong>.data</strong>   :This section might contain more data, such as a string that is stored in a variable that is defined in an executable.
 <strong>.plt</strong>    : This section contains information on the code which is being imported from an external library (in our case, functions like printf(), fgets() and strncmp()).</p>
<p>I won't be looking into rest of the sections as I still want to keep this post short.</p>
<p><img alt="ghidra disassembler view" src="/static/images/exe-sc2.png" title="exe-sc2.png"></p>
<hr>
<h3><strong>Bringing It All Back Together</strong></h3>
<p><strong>.text</strong> section starts with an internal function, <strong>undefined __start()</strong> which was generated by the compiler. Most of the instructions are not worth looking into but their <strong>call</strong> instruction which calls an <strong>external</strong> function defined as <strong>__libc_start_main</strong>, which requires 3 different pointers to <em>interesting memory locations </em>.
Again, since this executable is not stripped, we can clearly see that the address of <strong>main()</strong> is being loaded into <strong>RDI</strong>. Simply double clicking on main will lead us to the disassembled code of our original C program. Note that the varible that contains the password to our executable is not defined anywhere since the variable was never used.</p>
<p><img alt="ghidra disassembler view-2" src="/static/images/exe-sc3.png" title="exe-sc3.png"></p>
<p>As you can see, pretty simple, well defined assembly code for our C program has been found. upon further analysis, we can see some call to functions like malloc, printf, fgets, strncmp, puts and finally __stack_chk_fail which are all external functions. None of the functions other than <strong>stack_chk_fail</strong> needs any explaination. <strong>stack_chk_fail</strong> is needed for a protection system called <strong>stack canary</strong>. Finally we see <strong>RET</strong> and that the end of this long post.</p>
<p>JK, Its 5 in the morning now and I don't care abou this post anymore. Let me know I you want me to dive deeper into this rabbit hole.</p>
<blockquote>
<p>“If you know the enemy and know yourself, you need not fear the result of a hundred battles.
 If you know yourself but not the enemy, for every victory gained you will also suffer a defeat.
 If you know neither the enemy nor yourself, you will succumb in every battle.”  - Sun Tzu</p>
</blockquote>
<p><img alt="redacted" src="/static/images/uc.png" title="Under Construction">__</p>
            </div>
            <!-- /.entry-content -->
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>
<!-- Sidebar -->
<section class="well well-sm">
  <ul class="list-group list-group-flush">

<!-- Sidebar/Social -->
<li class="list-group-item">
  <h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
  <ul class="list-group" id="social">
    <li class="list-group-item"><a href="https://github.com/samarthkathal"><i class="fa fa-github-square fa-lg"></i> GitHub</a></li>
    <li class="list-group-item"><a href="https://twitter.com/samarth_kathal"><i class="fa fa-twitter-square fa-lg"></i> Twitter</a></li>
    <li class="list-group-item"><a href="https://www.instagram.com/samarth.kathal/"><i class="fa fa-instagram fa-lg"></i> Instagram</a></li>
  </ul>
</li>
<!-- End Sidebar/Social -->

<!-- Sidebar/Categories -->
<li class="list-group-item">
  <h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Categories</span></h4>
  <ul class="list-group" id="categories">
    <li class="list-group-item">
      <a href="/category/misc.html"><i class="fa fa-folder-open fa-lg"></i>misc</a>
    </li>
    <li class="list-group-item">
      <a href="/category/reverse-engineering.html"><i class="fa fa-folder-open fa-lg"></i>reverse-engineering</a>
    </li>
  </ul>
</li>
<!-- End Sidebar/Categories -->

<!-- Sidebar/Links -->
<li class="list-group-item">
  <h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
  <ul class="list-group" id="links">
    <li class="list-group-item">
      <a href="http://getpelican.com/" target="_blank">Pelican</a>
    </li>
    <li class="list-group-item">
      <a href="http://python.org/" target="_blank">Python.org</a>
    </li>
    <li class="list-group-item">
      <a href="http://jinja.pocoo.org/" target="_blank">Jinja2</a>
    </li>
    <li class="list-group-item">
      <a href="#" target="_blank">You can modify those links in your config file</a>
    </li>
  </ul>
</li>
<!-- End Sidebar/Links -->
  </ul>
</section>
<!-- End Sidebar -->            </aside>
        </div>
    </div>
</div>
<!-- End Content Container -->

<footer>
   <div class="container-fluid">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2020 samarth
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="/theme/js/respond.min.js"></script>




</body>
</html>